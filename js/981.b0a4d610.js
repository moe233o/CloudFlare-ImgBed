"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[981],{1611:function(e,t,i){i.r(t),i.d(t,{default:function(){return p}});var s=i(2938),n=i(6768);function o(e,t,i,o,a,l){const r=s.A;return(0,n.uX)(),(0,n.Wv)(r,{title:l.loginTitle,fields:a.loginFields,"submit-text":"Log in","background-key":"loginBkImg","is-admin":!1,loading:a.isLoading,onSubmit:l.handleLogin},null,8,["title","fields","loading","onSubmit"])}i(4114);var a=i(4570),l=i.n(a),r=i(457),d=i(8401),u={data(){return{isLoading:!1,loginFields:[{key:"password",label:"",placeholder:"Please enter the authentication code",type:"password",showPassword:!0,icon:"Lock"}]}},computed:{...(0,d.L8)(["userConfig"]),ownerName(){return this.userConfig?.ownerName||"OIMG"},loginTitle(){return"Login OIMG"}},components:{BaseLogin:s.A},methods:{async handleLogin(e){const{password:t}=e,i=""===t?"unset":t;this.isLoading=!0;const s=new Promise(e=>setTimeout(e,500)),n=r.A.post("/api/login",{authCode:t}).then(e=>({res:e})).catch(e=>({err:e}));try{const[e]=await Promise.all([n,s]);e.res&&200===e.res.status?(l().set("authCode",i,"14d"),this.$router.push("/"),this.$message.success("Login successful")):(this.isLoading=!1,this.$message.error("Login failed. Please check your password"))}catch(o){this.isLoading=!1,this.$message.error("System error")}}}},c=i(1241);const h=(0,c.A)(u,[["render",o]]);var p=h},2938:function(e,t,i){i.d(t,{A:function(){return F}});var s=i(1472),n=i(47),o=(i(5331),i(9648),i(9623)),a=(i(6711),i(813)),l=(i(4896),i(4453)),r=i(6768),d=i(4232),u=i(5130);const c={class:"login-container"},h={class:"login-title",tabindex:"0"},p={class:"input-wrapper"},g={key:0,class:"loading-ring"},m={key:1};function f(e,t,i,f,y,b){const k=l.A,w=a.tk,L=o.WK,v=n.S2,F=s.A;return(0,r.uX)(),(0,r.CE)("div",{class:(0,d.C4)(["login",{"is-focused":y.isFocused}])},[(0,r.bF)(k,{class:"toggle-dark"}),(0,r.Lk)("div",c,[(0,r.Lk)("h1",h,(0,d.v_)(i.title),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.fields,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:e.key,class:"input-container"},[(0,r.Lk)("label",{class:"input-name",ref_for:!0,ref:`inputLabel${t}`,style:(0,d.Tr)({"--underline-width":y.labelUnderlineWidths[t]+"px"})},(0,d.v_)(e.label),5),(0,r.Lk)("div",p,[(0,r.bF)(L,{modelValue:y.formData[e.key],"onUpdate:modelValue":t=>y.formData[e.key]=t,placeholder:e.placeholder,type:e.type||"text","show-password":e.showPassword,class:"password-input",onKeyup:(0,u.jR)(b.handleSubmit,["enter","native"]),onFocus:b.handleInputFocus,onBlur:b.handleInputBlur},(0,r.eX)({_:2},[e.icon?{name:"prefix",fn:(0,r.k6)(()=>[(0,r.bF)(w,{class:"el-input__icon"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon)))]),_:2},1024)]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue","placeholder","type","show-password","onKeyup","onFocus","onBlur"])])]))),128)),(0,r.bF)(v,{class:(0,d.C4)(["submit",{"is-loading":i.loading}]),type:"primary",onClick:b.handleSubmit,disabled:i.loading},{default:(0,r.k6)(()=>[i.loading?((0,r.uX)(),(0,r.CE)("div",g)):((0,r.uX)(),(0,r.CE)("span",m,(0,d.v_)(i.submitText),1))]),_:1},8,["class","onClick","disabled"])]),(0,r.bF)(F,{class:"footer"})],2)}i(8111),i(7588);var y=i(732),b=i(8401),k=i(8903),w={name:"BaseLogin",mixins:[k.A],props:{title:{type:String,required:!0},fields:{type:Array,required:!0},submitText:{type:String,default:"登录"},backgroundKey:{type:String,required:!0},isAdmin:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},data(){return{formData:{},labelUnderlineWidths:[],isFocused:!1}},computed:{...(0,b.L8)(["userConfig"])},watch:{fields:{handler(){this.$nextTick(()=>{this.calculateLabelWidths()})},deep:!0}},components:{Footer:s.A,ToggleDark:l.A,Logo:y.A},mounted(){this.initFormData(),this.initializeBackground(this.backgroundKey,".login",!this.isAdmin,!0),this.$nextTick(()=>{this.calculateLabelWidths()})},methods:{initFormData(){const e={};this.fields.forEach(t=>{e[t.key]=""}),this.formData=e,this.labelUnderlineWidths=new Array(this.fields.length).fill(0)},calculateLabelWidths(){this.$nextTick(()=>{this.fields.forEach((e,t)=>{const i=this.$refs[`inputLabel${t}`];if(i&&i[0]){const s=document.createElement("canvas"),n=s.getContext("2d"),o=i[0],a=window.getComputedStyle(o);n.font=`${a.fontWeight} ${a.fontSize} ${a.fontFamily}`;const l=n.measureText(e.label).width;this.labelUnderlineWidths[t]=Math.ceil(l)+3}})})},handleSubmit(){this.loading||this.$emit("submit",{...this.formData})},handleInputFocus(e){this.isFocused=!0;const t=e.target.closest(".input-container");if(t){const e=t.querySelector(".input-wrapper");e&&e.classList.add("focused")}},handleInputBlur(e){this.isFocused=!1;const t=e.target.closest(".input-container");if(t){const e=t.querySelector(".input-wrapper");e&&e.classList.remove("focused")}}}},L=i(1241);const v=(0,L.A)(w,[["render",f],["__scopeId","data-v-9f5cf108"]]);var F=v}}]);
//# sourceMappingURL=981.b0a4d610.js.map